# 重启服务说明

## 问题原因

当你使用 `start.py` 启动服务后，如果修改了后端代码（如 `app.py`、`db_adapter.py`、`utils.py` 等），**后端服务不会自动重新加载**，需要手动重启。

## 解决方案

### 方法1：使用 start.py 重启（推荐）

1. **停止当前服务**：
   - 在运行 `start.py` 的终端窗口中按 `Ctrl+C`
   - 这会停止前端和后端服务

2. **重新启动**：
   ```bash
   python start.py
   ```

### 方法2：只重启后端服务

如果只想重启后端（前端继续运行）：

1. **找到后端进程**：
   ```powershell
   # Windows PowerShell
   netstat -ano | findstr :8000
   ```
   这会显示占用8000端口的进程ID（PID）

2. **结束后端进程**：
   ```powershell
   taskkill /pid <PID> /f
   ```
   将 `<PID>` 替换为实际的进程ID

3. **重新启动后端**：
   ```bash
   cd backend
   python app.py
   ```

### 方法3：使用 Flask 的自动重载功能

Flask 开发模式支持自动重载，但需要确保：
- `app.run(debug=True)` 已设置（已在代码中设置）
- 修改代码后，Flask 会自动检测并重启

**注意**：如果修改了导入的模块（如 `utils.py`），Flask 可能不会自动重载，需要手动重启。

## 验证修复

重启后，测试创建会话功能：

1. **检查后端日志**：
   启动后端后，应该看到：
   ```
   ✅ 数据库连接正常 (SQLite)
   * Running on all addresses (0.0.0.0)
   * Running on http://127.0.0.1:8000
   ```

2. **测试API**：
   在浏览器中访问：
   ```
   http://localhost:8000/api/health
   ```
   应该返回：
   ```json
   {
     "status": "healthy",
     "database": "connected",
     "timestamp": "..."
   }
   ```

3. **测试创建会话**：
   在前端页面点击"开始检测"，应该不再出现 `validate_exercise_type` 未定义的错误。

## 常见问题

### Q: 为什么修改代码后没有生效？
A: Flask 开发模式会自动重载，但有时需要手动重启，特别是：
- 修改了导入的模块（如 `utils.py`）
- 修改了数据库模型（`database.py`）
- 修改了配置文件

### Q: 如何确认后端已重启？
A: 查看后端终端输出，应该看到：
```
 * Restarting with stat
 * Debugger is active!
```

### Q: 重启后仍然报错？
A: 检查：
1. 后端终端是否有错误日志
2. 是否所有依赖都已安装：`pip install -r backend/requirements.txt`
3. 数据库是否正常：运行 `python backend/check_backend.py`

## 快速重启脚本

创建一个 `restart_backend.bat`（Windows）或 `restart_backend.sh`（Mac/Linux）：

**Windows (restart_backend.bat)**:
```batch
@echo off
echo 停止后端服务...
for /f "tokens=5" %%a in ('netstat -ano ^| findstr :8000 ^| findstr LISTENING') do (
    taskkill /pid %%a /f
)
timeout /t 2 /nobreak >nul
echo 启动后端服务...
cd backend
start "后端服务" python app.py
cd ..
echo 后端服务已启动
pause
```

**Mac/Linux (restart_backend.sh)**:
```bash
#!/bin/bash
echo "停止后端服务..."
lsof -ti:8000 | xargs kill -9 2>/dev/null || true
sleep 2
echo "启动后端服务..."
cd backend
python app.py &
cd ..
echo "后端服务已启动"
```

